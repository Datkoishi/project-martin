<!DOCTYPE html>
<html class="no-js" lang="ZXX">
    <head>
        <!-- Meta Tags -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="robots" content="all" />
        <meta name="keywords" content="online learning, education, e-learning, courses, tutorials, educational resources, skill development, career enhancement" />

        <link rel="icon" type="image/x-icon" href="./assets/images/icon.jpg" />

        <!-- Tiêu đề trang -->
        <title>Martin Academy - Giáo dục, Khóa học & Học trực tuyến</title>
    
        <!-- Liên kết CSS -->
<link rel="stylesheet" href="../assets/plugins/css/bootstrap.min.css">
<link rel="stylesheet" href="../assets/plugins/css/animate.min.css">
<link rel="stylesheet" href="../assets/plugins/css/owl.carousel.min.css">
<link rel="stylesheet" href="../assets/plugins/css/maginific-popup.min.css">
<link rel="stylesheet" href="../assets/plugins/css/nice-select.min.css">
<link rel="stylesheet" href="../assets/plugins/css/icofont.css">
<link rel="stylesheet" href="../assets/plugins/css/uicons.css">
<link rel="stylesheet" href="../style.css">

    </head>
    <body class="ep-magic-cursor">

        <!-- Start Preloader  -->
        <!-- 
        <div id="preloader">
            <svg class="pl" width="240" height="240" viewBox="0 0 240 240">
                <circle class="pl__ring pl__ring--a" cx="120" cy="120" r="105" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 660" stroke-dashoffset="-330" stroke-linecap="round"></circle>
                <circle class="pl__ring pl__ring--b" cx="120" cy="120" r="35" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 220" stroke-dashoffset="-110" stroke-linecap="round"></circle>
                <circle class="pl__ring pl__ring--c" cx="85" cy="120" r="70" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 440" stroke-linecap="round"></circle>
                <circle class="pl__ring pl__ring--d" cx="155" cy="120" r="70" fill="none" stroke="#000" stroke-width="20" stroke-dasharray="0 440" stroke-linecap="round"></circle>
            </svg>
        </div>
        -->
        <!-- End Preloader -->

        <!-- Start Cursor To Top  -->
        <div class="cursor"></div>
        <div class="cursor2"></div>
        <!-- End Cursor To Top -->

        <!-- Start Begin Magic Cursor -->
        <div id="magic-cursor">
            <div id="ball"></div>
        </div>
        <!-- End Begin Magic Cursor -->

        <!-- Start Back To Top  -->
        <div class="progress-wrap">
            <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
            </svg>
        </div>
        <!-- End Back To Top -->

        <!-- Menu di động -->
    <div class="modal mobile-menu-modal offcanvas-modal fade" id="offcanvas-modal">
        <div class="modal-dialog offcanvas-dialog">
            <div class="modal-content">
                <div class="modal-header offcanvas-header">
                    <!-- Bắt đầu logo ngoài canvas -->
                    <div class="offcanvas-logo">
                        <a href="index.html">
                            <img src="./assets/images/logo.jpg" alt="#" />
                        </a>
                    </div>
                    <!-- Kết thúc logo ngoài canvas -->
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng">
              <i class="fi fi-ss-cross"></i>
            </button>
                </div>
                <div class="mobile-menu-modal-main-body">
                    <!-- Bắt đầu menu ngoài canvas -->
                    <nav id="offcanvas-menu" class="navigation offcanvas-menu">
                        <ul id="nav mobile-nav" class="list-none offcanvas-men-list">
                            <li>
                                <a class="menu-arrow" href="javascript:void(0)">Trang chủ</a>
                                <ul class="sub-menu">
                                    <li>
                                        <a href="index.html">Trang chủ</a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <a class="menu-arrow" href="javascript:void(0)">Làm kiểm tra</a>
                                <ul class="sub-menu">
                                    <li>
                                        <a href="choiceclass.html">Kiểm tra</a>
                                    </li>
                                    <li>
                                        <a href="history.html">Xem lịch sử</a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <a class="menu-arrow" href="javascript:void(0)">Tạo bài kiểm tra</a>
                                <ul class="sub-menu">
                                    <li>
                                        <a href="choice_creative.html">Tạo bài kiểm tra</a>
                                    </li>
                                    <li>
                                        <a href="history_cr.html">Bài thi đã tạo</a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <a class="menu-arrow" href="javascript:void(0)">Sự kiện</a>
                                <ul class="sub-menu">
                                    <li>
                                        <a href="404.html">Sự kiện</a>
                                    </li>
                                    <li>
                                        <a href="404.html">Chi tiết sự kiện</a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <a class="menu-arrow" href="javascript:void(0)">Trang</a>
                                <ul class="sub-menu">
                                    <li>
                                        <a href="404.html">Về chúng tôi</a>
                                    </li>
                                    <li>
                                        <a href="404.html">Đội ngũ</a>
                                    </li>
                                    <li>
                                        <a href="404.html">Chi tiết đội ngũ</a>
                                    </li>
                                    <li>
                                        <a href="login.html">Đăng nhập</a>
                                    </li>
                                    <li>
                                        <a href="register.html">Đăng ký</a>
                                    </li>
                                    
                                </ul>
                            </li>
                          
                            <li>
                                <a class="menu-arrow" href="javascript:void(0)">Blog</a>
                                <ul class="sub-menu">
                                    <li>
                                        <a href="404.html">Blog</a>
                                    </li>
                                    <li>
                                        <a href="404.html">Chi tiết blog</a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <a href="404.html">Liên hệ</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <!-- Kết thúc menu di động -->

    <!-- Bắt đầu khu vực tiêu đề -->
    <header class="ep-header position-relative section-bg-1">
        <!-- Thanh trên cùng -->
        <div class="ep-topbar">
            <div class="container ep-container">
                <div class="row align-items-center">
                    <div class="col-lg-2 col-6">
                        <div class="ep-topbar__column">
                            <div class="ep-logo">
                                <a href="index.html">
                                    <img src="./assets/images/logo.jpg" width="1000px" alt="logo" />
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-10 col-6">
                        <div class="ep-topbar__column ep-topbar__column2">
                            <div class="ep-topbar__search-widget">
                                <div class="ep-topbar__category">
                                    <select>
                      <option data-display="Tất cả">Tất cả</option>
                      <option value="1">Bạn học</option>
                      <option value="2">Dịch vụ gia sư</option>
                      <option value="3">Quảng cáo kỹ thuật số</option>
                      <option value="4">Khóa học trực tuyến</option>
                      <option value="5">Dịch vụ gia sư</option>
                    </select>
                                </div>
                                <div class="ep-topbar__search">
                                    <form action="#" method="post">
                                        <input type="search" name="search" placeholder="Tìm kiếm" required />
                                        <button type="submit">
                        <i class="fi-rr-search"></i>
                      </button>
                                    </form>
                                </div>
                            </div>
                            <a href="contact.html" class="ep-header__account">
                                <div class="ep-header__account">
                                    <i class="fi fi-rr-user"></i>
                                      <div class="ep-header__account-info">
                                      <span span>Loading...</span> <!-- This will be replaced by the script -->
                                       <p>Đang hoạt động</p>
                                      </div>
                                  </div>
                                <script>
                                  document.addEventListener('DOMContentLoaded', function() {
                                    const userNameElement = document.querySelector('.ep-header__account-info span');
                                    const userName = localStorage.getItem('userName');
        
                                          if (userNameElement && userName) {
                                            userNameElement.textContent = userName;
                                            }
                                          });
           
                                  </script>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Kết thúc thanh trên cùng -->
        <!-- Thanh giữa tiêu đề -->
        <div id="active-sticky" class="ep-header__middle">
            <div class="container ep-container">
                <div class="ep-header__inner">
                    <div class="row align-items-center">
                        <div class="col-lg-10 col-12">
                            <nav class="ep-header__navigation">
                                <ul class="ep-header__menu">
                                    <li class="active">
                                        <a href="#">Trang chủ <i class="fi fi-ss-angle-small-down"></i>
                      </a>
                                        <ul class="sub-menu">
                                            <li class="active">
                                                <a href="index.html">Trang chủ</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>
                                      <a href="#">Làm kiểm tra<i class="fi fi-ss-angle-small-down"></i>
                    </a>
                                      <ul class="sub-menu">
                                          <li>
                                              <a href="choiceclass.html">Kiểm tra</a>
                                          </li>
                                          <li>
                                              <a href="history.html">Xem lịch sử</a>
                                          </li>
                                      </ul>
                                  </li>
                                  <li>
                                    <a href="#">Tạo bài kiểm tra<i class="fi fi-ss-angle-small-down"></i>
                  </a>
                                    <ul class="sub-menu">
                                        <li>
                                            <a href="choice_creative.html">Tạo bài kiểm tra</a>
                                        </li>
                                        <li>
                                            <a href="history_cr.html">Bài thi đã tạo</a>
                                        </li>
                                    </ul>
                                </li>
                                    <li>
                                        <a href="#">Sự kiện <i class="fi fi-ss-angle-small-down"></i>
                      </a>
                                        <ul class="sub-menu">
                                            <li>
                                                <a href="404.html">Sự kiện</a>
                                            </li>
                                            <li>
                                                <a href="404.html">Chi tiết sự kiện</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a href="#">Trang <i class="fi fi-ss-angle-small-down"></i>
                      </a>
                                        <ul class="sub-menu">
                                            <li>
                                                <a href="404.html">Về chúng tôi</a>
                                            </li>
                                            <li>
                                                <a href="404.html">Đội ngũ</a>
                                            </li>
                                            <li>
                                                <a href="404.html">Chi tiết đội ngũ</a>
                                            </li>
                                            <li>
                                                <a href="login.html">Đăng nhập</a>
                                            </li>
                                            <li>
                                                <a href="register.html">Đăng ký</a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                    <li>
                                        <a href="#">Thư viện <i class="fi fi-ss-angle-small-down"></i>
                      </a>
                                        <ul class="sub-menu">
                                            
                                            <li>
                                                <a href="404.html">Danh sách yêu thích</a>
                                            </li>
                                           
                                        </ul>
                                    </li>
                                    <li>
                                        <a href="#">Blog <i class="fi fi-ss-angle-small-down"></i>
                      </a>
                                        <ul class="sub-menu">
                                            <li>
                                                <a href="404.html">Blog</a>
                                            </li>
                                            <li>
                                                <a href="404.html">Chi tiết blog</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a href="404.html">Liên hệ</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                        <div class="col-lg-12 col-xl-2 col-12">
                            <div class="ep-header__right">
                               <!-- <div class="ep-topbar__action">
                                    <div class="ep-topbar__wishlist">
                                        <a href="wishlist.html" class="ep-topbar__action-icon">
                                            <i class="fi-rr-heart"></i>
                                            <span></span>
                                        </a>
                                    </div>
                                </div>-->
                                <!-- Nút menu di động -->
                                <button type="button" class="mobile-menu-offcanvas-toggler" data-bs-toggle="modal" data-bs-target="#offcanvas-modal">
                    <span class="line"></span>
                    <span class="line"></span>
                    <span class="line"></span>
                  </button>
                                <!-- Kết thúc nút menu di động -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
        <!-- End Header Area -->
        <div id="smooth-wrapper">
            <div id="smooth-content">
                <main>
                    <!-- Start Breadcrumbs Area -->
                    <div class="ep-breadcrumbs breadcrumbs-bg background-image" style="background-image: url('./assets/images/breadcrumbs-bg.png')">
                        <div class="container">
                            <div class="row justify-content-center">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <div class="ep-breadcrumbs__content">
                                        <h3 class="ep-breadcrumbs__title">Chọn môn ra bài</h3>
                                        <ul class="ep-breadcrumbs__menu">
                                            <li>
                                                <a href="index.html">Trang chủ</a>
                                            </li>
                                            <li>
                                                <i class="fi-bs-angle-right"></i>
                                            </li>
                                            <li class="active">
                                                <a href="choiceclass.html">Chọn lớp</a>
                                            </li>
                                            <li>
                                                <i class="fi-bs-angle-right"></i>
                                            </li>
                                            <li class="active">
                                                <a href="blog.html">Chọn môn</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Breadcrumbs Area -->
                    <!-- Start Blog Area -->
                    <section class="ep-blog-page section-gap position-relative">
                        <div class="container ep-container">
                            <div class="row">
                                <!-- Danh sách môn học để tạo bài kiểm tra -->
                                <div class="col-lg-12 col-xl-8 col-12">
                                    <div class="ep-blog__list">
                    
                                        <!-- Môn Toán -->
                                        <div class="ep-blog__card ep-blog__card--style2">
                                            <a href="javascript:void(0)" class="ep-blog__img" data-subject-id="math">
                                                <img src="./assets/images/img-kiemtra/kt_toanl1.png" alt="math-class-1-img" />
                                            </a>
                                            <div class="ep-blog__info">
                                                <div class="ep-blog__date">Toán</div>
                                                <div class="ep-blog__content">
                                                    <div class="ep-blog__meta">
                                                        <ul>
                                                            <li><i class="fi-rr-comments"></i>Tạo bài kiểm tra Toán</li>
                                                            <li><a href="#"><i class="fi-rr-user"></i>By admin</a></li>
                                                        </ul>
                                                    </div>
                                                    <a href="javascript:void(0)" class="ep-blog__title" data-subject-id="math">
                                                        <h5 class="m-0">Tạo bài kiểm tra cho môn Toán</h5>
                                                    </a>
                                                    <div class="ep-blog__btn">
                                                        <a href="javascript:void(0)" data-subject-id="math">Tạo bài kiểm tra <i class="fi fi-rs-arrow-small-right"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                    
                                        <!-- Môn Văn -->
                                        <div class="ep-blog__card ep-blog__card--style2">
                                            <a href="javascript:void(0)" class="ep-blog__img" data-subject-id="literature">
                                                <img src="./assets/images/img-kiemtra/kt_vanl1.png" alt="literature-class-1-img" />
                                            </a>
                                            <div class="ep-blog__info">
                                                <div class="ep-blog__date">Văn</div>
                                                <div class="ep-blog__content">
                                                    <div class="ep-blog__meta">
                                                        <ul>
                                                            <li><i class="fi-rr-comments"></i>Tạo bài kiểm tra Văn</li>
                                                            <li><a href="#"><i class="fi-rr-user"></i>By admin</a></li>
                                                        </ul>
                                                    </div>
                                                    <a href="javascript:void(0)" class="ep-blog__title" data-subject-id="literature">
                                                        <h5 class="m-0">Tạo bài kiểm tra cho môn Văn</h5>
                                                    </a>
                                                    <div class="ep-blog__btn">
                                                        <a href="javascript:void(0)" data-subject-id="literature">Tạo bài kiểm tra <i class="fi fi-rs-arrow-small-right"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                    
                                        <!-- Môn Tin học -->
                                        <div class="ep-blog__card ep-blog__card--style2">
                                            <a href="javascript:void(0)" class="ep-blog__img" data-subject-id="it">
                                                <img src="./assets/images/img-kiemtra/kt_tinl1.png" alt="it-class-1-img" />
                                            </a>
                                            <div class="ep-blog__info">
                                                <div class="ep-blog__date">Tin học</div>
                                                <div class="ep-blog__content">
                                                    <div class="ep-blog__meta">
                                                        <ul>
                                                            <li><i class="fi-rr-comments"></i>Tạo bài kiểm tra Tin học</li>
                                                            <li><a href="#"><i class="fi-rr-user"></i>By admin</a></li>
                                                        </ul>
                                                    </div>
                                                    <a href="javascript:void(0)" class="ep-blog__title" data-subject-id="it">
                                                        <h5 class="m-0">Tạo bài kiểm tra cho môn Tin học</h5>
                                                    </a>
                                                    <div class="ep-blog__btn">
                                                        <a href="javascript:void(0)" data-subject-id="it">Tạo bài kiểm tra <i class="fi fi-rs-arrow-small-right"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                    
                                        <!-- Môn Tiếng Anh -->
                                        <div class="ep-blog__card ep-blog__card--style2">
                                            <a href="javascript:void(0)" class="ep-blog__img" data-subject-id="english">
                                                <img src="./assets/images/img-kiemtra/kt_anh.png" alt="english-class-1-img" />
                                            </a>
                                            <div class="ep-blog__info">
                                                <div class="ep-blog__date">Tiếng Anh</div>
                                                <div class="ep-blog__content">
                                                    <div class="ep-blog__meta">
                                                        <ul>
                                                            <li><i class="fi-rr-comments"></i>Tạo bài kiểm tra Tiếng Anh</li>
                                                            <li><a href="#"><i class="fi-rr-user"></i>By admin</a></li>
                                                        </ul>
                                                    </div>
                                                    <a href="javascript:void(0)" class="ep-blog__title" data-subject-id="english">
                                                        <h5 class="m-0">Tạo bài kiểm tra cho môn Tiếng Anh</h5>
                                                    </a>
                                                    <div class="ep-blog__btn">
                                                        <a href="javascript:void(0)" data-subject-id="english">Tạo bài kiểm tra <i class="fi fi-rs-arrow-small-right"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                    
                                    </div>
                                </div>
                    
                                <!-- Sidebar: Mẹo học tập và các chuyên mục khác -->
                                <div class="col-lg-6 col-xl-4 col-md-8 col-12">
                                    <div class="ep-blog__sidebar">
                                        
                                        <!-- Tìm kiếm -->
                                        <div class="ep-blog__sidebar-widget">
                                            <h4 class="ep-blog__sidebar-title">Tìm kiếm</h4>
                                            <form action="#" method="post" class="ep-blog__sidebar-search">
                                                <input type="search" name="search" placeholder="Tìm kiếm..." required />
                                                <button type="submit"><i class="fi-rr-search"></i></button>
                                            </form>
                                        </div>
                    
                                        <!-- Mẹo học tập hiệu quả -->
                                        <div class="ep-blog__sidebar-widget">
                                            <h4 class="ep-blog__sidebar-title">Mẹo học tập hiệu quả</h4>
                                            <div class="ep-blog__sidebar-tips">
                                                <div class="ep-blog__tip-item">
                                                    <h6>Quản lý thời gian</h6>
                                                    <p>Hãy lập kế hoạch học tập hợp lý và chia nhỏ thời gian cho từng môn học.</p>
                                                </div>
                                                <div class="ep-blog__tip-item">
                                                    <h6>Ôn lại bài ngay sau giờ học</h6>
                                                    <p>Ôn lại kiến thức sau mỗi buổi học giúp bạn ghi nhớ lâu hơn.</p>
                                                </div>
                                                <div class="ep-blog__tip-item">
                                                    <h6>Học nhóm</h6>
                                                    <p>Học nhóm giúp bạn giải đáp những thắc mắc và học hỏi thêm nhiều điều mới.</p>
                                                </div>
                                            </div>
                                        </div>
                    
                                        <!-- Chuyên mục -->
                                        <div class="ep-blog__sidebar-widget">
                                            <h4 class="ep-blog__sidebar-title">Chuyên mục</h4>
                                            <div class="ep-blog__sidebar-category">
                                                <ul>
                                                    <li><a href="#">Toán học <span>(02)</span></a></li>
                                                    <li><a href="#">Văn học <span>(05)</span></a></li>
                                                    <li><a href="#">Khoa học tự nhiên <span>(10)</span></a></li>
                                                    <li><a href="#">Tiếng Anh <span>(03)</span></a></li>
                                                </ul>
                                            </div>
                                        </div>
                    
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
    // Khởi tạo state cho subjects
    let subjectsData = [];

    // Lấy class ID từ URL
    const urlParams = new URLSearchParams(window.location.search);
    const classId = urlParams.get('class');

    if (!classId) {
        showError('Vui lòng chọn lớp học trước');
        window.location.href = 'choice_creative.html';
        return;
    }

    // Lấy token từ localStorage
    const token = localStorage.getItem('token');
    if (!token) {
        showError('Vui lòng đăng nhập lại');
        window.location.href = '/login';
        return;
    }

    // Lấy danh sách môn học từ server khi trang được load
    fetchSubjects();

    async function fetchSubjects() {
        try {
            console.log('Bắt đầu lấy danh sách môn học');
            console.log('Token:', token);

            const response = await fetch('/api/exam/subjects', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });
            
            console.log('Response status:', response.status);
            const data = await response.json();
            console.log('Response data:', data);

            if (!response.ok) {
                throw new Error(data.message || 'Không thể lấy danh sách môn học');
            }

            if (data.success && Array.isArray(data.subjects)) {
                subjectsData = data.subjects;
                console.log('Subjects data received:', subjectsData);
                initializeSubjectCards(data.subjects);
            } else {
                throw new Error(data.message || 'Không có dữ liệu môn học');
            }
        } catch (error) {
            console.error('Chi tiết lỗi:', error);
            showError('Không thể lấy danh sách môn học. Vui lòng thử lại sau.');
        }
    }

    function initializeSubjectCards(subjects) {
        console.log('Initializing subject cards with:', subjects);
        const cards = document.querySelectorAll('.ep-blog__card');
        
        cards.forEach(card => {
            // Remove any existing disabled class first
            card.classList.remove('disabled');
            
            const subjectIdElement = card.querySelector('[data-subject-id]');
            if (subjectIdElement) {
                const uiSubjectId = subjectIdElement.getAttribute('data-subject-id');
                console.log('Processing UI subject:', uiSubjectId);
                
                const subject = findSubjectByUIId(uiSubjectId, subjects);
                if (subject) {
                    console.log('Found matching subject:', subject);
                    card.setAttribute('data-db-subject-id', subject.SubjectID.toString());
                    setupCardContent(card, subject);
                    addClickListener(card, subject.SubjectID);
                } else {
                    console.log('No matching subject found for:', uiSubjectId);
                    disableInvalidSubject(card);
                }
            }
        });
    }

    function setupCardContent(card, subject) {
        const title = card.querySelector('.ep-blog__title h5');
        const meta = card.querySelector('.ep-blog__meta ul li:first-child');
        const button = card.querySelector('.ep-blog__btn a');

        if (title) title.textContent = `Tạo bài kiểm tra cho môn ${subject.SubjectName}`;
        if (meta) meta.innerHTML = `<i class="fi-rr-comments"></i>Tạo bài kiểm tra ${subject.SubjectName}`;
        if (button) {
            button.textContent = `Tạo bài kiểm tra cho môn ${subject.SubjectName}`;
            button.href = 'javascript:void(0)';
        }
    }

    function addClickListener(card, subjectId) {
        const clickHandler = async function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (!card.classList.contains('disabled')) {
                try {
                    await handleSubjectSelection(subjectId, classId);
                } catch (error) {
                    showError(error.message);
                }
            }
        };

        // Add click handler to the card
        card.addEventListener('click', clickHandler);

        // Add click handler to the button
        const button = card.querySelector('.ep-blog__btn a');
        if (button) {
            button.addEventListener('click', clickHandler);
        }
    }

    function disableInvalidSubject(card) {
        card.classList.add('disabled');
        const title = card.querySelector('.ep-blog__title h5');
        const meta = card.querySelector('.ep-blog__meta ul li:first-child');
        const button = card.querySelector('.ep-blog__btn a');

        if (title) title.textContent = 'Môn học không khả dụng';
        if (meta) meta.innerHTML = '<i class="fi-rr-comments"></i>Không khả dụng';
        if (button) {
            button.textContent = 'Không khả dụng';
            button.href = 'javascript:void(0)';
        }
    }

    function findSubjectByUIId(uiId, subjects) {
        // Map UI IDs to subject names for matching
        const uiToSubjectName = {
            'math': 'Toán học',
            'literature': 'Ngữ văn',
            'it': 'Tin học',
            'english': 'Tiếng Anh'
        };

        const subjectName = uiToSubjectName[uiId.toLowerCase()];
        console.log('Looking for subject:', subjectName);
        const subject = subjects.find(s => s.SubjectName === subjectName);
        console.log('Found subject:', subject);
        return subject;
    }

    async function handleSubjectSelection(subjectId, classId) {
        console.log('Handling subject selection:', subjectId, classId);
        const subject = subjectsData.find(s => s.SubjectID === subjectId);
        
        if (!subject) {
            throw new Error('Môn học không hợp lệ');
        }

        updateAllCards(subjectId);

        try {
            await createNewExam(subject, classId);
        } catch (error) {
            updateAllCards(null);
            throw error;
        }
    }

    async function createNewExam(subject, classId) {
        console.log('Creating new exam:', subject, classId);
        const examName = `Bài kiểm tra ${subject.SubjectName} - Lớp ${classId}`;
        const now = new Date();
        const oneWeekLater = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);

        try {
            const response = await fetch('/api/exam/create-exam', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify({
                    examName,
                    subjectId: subject.SubjectID,
                    classId: parseInt(classId),
                    startDate: now.toISOString(),
                    endDate: oneWeekLater.toISOString()
                })
            });

            const data = await response.json();
            console.log('Create exam response:', data);

            if (!response.ok) {
                throw new Error(data.message || 'Lỗi khi tạo bài kiểm tra');
            }

            if (data.success) {
                sessionStorage.setItem('examId', data.examId);
                window.location.href = `creative_quiz.html?class=${classId}&subject=${subject.SubjectID}&exam=${data.examId}`;
            } else {
                throw new Error(data.message || 'Tạo bài kiểm tra thất bại');
            }
        } catch (error) {
            console.error('Lỗi khi tạo bài kiểm tra:', error);
            throw new Error('Có lỗi xảy ra khi tạo bài kiểm tra: ' + error.message);
        }
    }

    function updateAllCards(selectedSubjectId) {
        document.querySelectorAll('.ep-blog__card').forEach(card => {
            const dbSubjectId = parseInt(card.getAttribute('data-db-subject-id'));
            
            if (dbSubjectId === selectedSubjectId) {
                card.classList.add('selected');
                updateSelectedCardContent(card, true);
            } else {
                card.classList.remove('selected');
                const subject = subjectsData.find(s => s.SubjectID === dbSubjectId);
                if (subject) {
                    setupCardContent(card, subject);
                }
            }
        });
    }

    function updateSelectedCardContent(card, isSelected) {
        const dbSubjectId = parseInt(card.getAttribute('data-db-subject-id'));
        if (!dbSubjectId) return;

        const subject = subjectsData.find(s => s.SubjectID === dbSubjectId);
        if (!subject) return;

        const title = card.querySelector('.ep-blog__title h5');
        const meta = card.querySelector('.ep-blog__meta ul li:first-child');
        const button = card.querySelector('.ep-blog__btn a');

        if (title) title.textContent = `Môn ${subject.SubjectName} đã được chọn`;
        if (meta) meta.innerHTML = `<i class="fi-rr-comments"></i>Đã chọn môn ${subject.SubjectName}`;
        if (button) {
            button.textContent = 'Đang tạo bài kiểm tra...';
            button.classList.add('disabled');
        }
        card.classList.add('pulse-animation');
    }

    function showError(message) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.textContent = message;
        errorDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #ff4444;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.5s ease-out;
        `;

        document.body.appendChild(errorDiv);

        setTimeout(() => {
            errorDiv.style.animation = 'slideOut 0.5s ease-out';
            setTimeout(() => {
                errorDiv.remove();
            }, 500);
        }, 3000);
    }

    // Add CSS for animations and styling
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .ep-blog__card.selected {
            border: 2px solid #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
            transform: translateY(-5px);
            transition: all 0.3s ease;
        }

        .ep-blog__card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .ep-blog__card:not(.disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .ep-blog__card.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #f5f5f5;
        }

        .pulse-animation {
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .error-message {
            font-family: system-ui, -apple-system, sans-serif;
            font-size: 14px;
            font-weight: 500;
        }
    `;
    document.head.appendChild(style);
});


                    </script>
                    
                    
                    <!-- End Blog Area -->
                </main>
                <!-- Start Footer Area -->
                <footer class="ep-footer position-relative">
                    <div class="container ep-container">
                      <div class="ep-footer__top">
                        <div class="row">
                          <!-- Giới thiệu ngắn gọn về nền tảng -->
                          <div class="col-lg-3 col-md-6 col-12">
                            <div class="ep-footer__widget footer-about">
                              <div class="ep-footer__logo">
                                <a href="index.html">
                                  <img src="./assets/images/logo2.jpg" alt="logo chân trang" />
                                </a>
                              </div>
                              <p class="ep-footer__text">
                                Đây là nền tảng học tập trực tuyến hàng đầu, hỗ trợ học sinh và người đi làm phát triển kỹ năng toàn diện, từ lập trình, ngoại ngữ đến các bài kiểm tra IQ và Chatbot AI hỗ trợ thông minh.
                              </p>
                              <div class="ep-footer__contact">
                                <div class="ep-footer__contact-single">
                                  <div class="ep-footer__contact-icon">
                                    <i class="fi fi-rs-marker"></i>
                                  </div>
                                  <div class="ep-footer__contact-info">
                                    <p>Địa chỉ</p>
                                    <span>Chưa có thông tin</span>
                                  </div>
                                </div>
                                <div class="ep-footer__contact-single">
                                  <div class="ep-footer__contact-icon">
                                    <i class="fi fi-rr-phone-call"></i>
                                  </div>
                                  <div class="ep-footer__contact-info">
                                    <p>Số điện thoại</p>
                                    <a href="tel:012 345 678 9101">Chưa có thông tin</a>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <!-- Về công ty -->
                          <div class="col-lg-3 col-md-4 col-12">
                            <div class="ep-footer__widget footer-links">
                              <h4 class="ep-footer__widget-title">Về công ty</h4>
                              <ul class="ep-footer__links-list">
                                <li><a href="service.html">Dịch vụ</a></li>
                                <li><a href="faq.html">Câu hỏi thường gặp</a></li>
                                <li><a href="testimonial.html">Lời chứng thực</a></li>
                                <li><a href="about.html">Về chúng tôi</a></li>
                                <li><a href="portfolio.html">Danh mục đầu tư</a></li>
                              </ul>
                            </div>
                          </div>
                          <!-- Dịch vụ và tính năng nổi bật -->
                          <div class="col-lg-3 col-md-6 col-12">
                            <div class="ep-footer__widget footer-services">
                              <h4 class="ep-footer__widget-title">Dịch vụ</h4>
                              <ul class="ep-footer__links-list">
                                <li><a href="service.html"><i class="fi fi-br-angle-double-small-right"></i> Chatbox AI Thông minh</a></li>
                                <li><a href="service.html"><i class="fi fi-br-angle-double-small-right"></i> Tài liệu Lập trình Frontend & Backend</a></li>
                                <li><a href="service.html"><i class="fi fi-br-angle-double-small-right"></i> Bài kiểm tra IQ</a></li>
                                <li><a href="service.html"><i class="fi fi-br-angle-double-small-right"></i> Thư viện Tài liệu Học tập</a></li>
                              </ul>
                            </div>
                          </div>
                          <!-- Đăng ký bản tin -->
                          <div class="col-lg-3 col-md-6 col-12">
                            <div class="ep-footer__widget footer-newsletter">
                              <h4 class="ep-footer__widget-title">Bản tin</h4>
                              <form action="#" method="post" class="ep-footer__newsletter">
                                <input type="email" name="email" placeholder="Email của bạn" required />
                                <button type="submit"><i class="fi fi-ss-paper-plane"></i></button>
                              </form>
                              <div class="ep-footer__social">
                                <h5 class="ep-footer__social-title">Theo dõi chúng tôi</h5>
                                <ul>
                                  <li><a href="#"><i class="icofont-facebook"></i></a></li>
                                  <li><a href="#"><i class="icofont-twitter"></i></a></li>
                                  <li><a href="#"><i class="icofont-linkedin"></i></a></li>
                                  <li><a href="#"><i class="icofont-pinterest"></i></a></li>
                                </ul>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="ep-footer__bottom">
                        <div class="row">
                          <div class="col-lg-6 col-12">
                            <div class="ep-footer__copyright">
                              <p>© <a target="_blank" href="https://truongdat.glitch.me/">TruongDat</a> 2024 | Tất cả các quyền được bảo lưu</p>
                            </div>
                          </div>
                          <div class="col-lg-6 col-12">
                            <div class="ep-footer__bottom-link">
                              <ul>
                                <li><a href="#">Điều khoản & Điều kiện</a></li>
                                <li><a href="#">Chính sách bảo mật</a></li>
                                <li><a href="contact.html">Liên hệ</a></li>
                              </ul>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="ep-footer__pattern">
                      <img src="./assets/images/footer/footer-pattern.png" alt="mẫu chân trang" />
                    </div>
                  </footer>
                <!-- End Footer Area -->
            </div>
        </div>
        <script src="../assets/plugins/js/jquery.min.js"></script>
<script src="../assets/plugins/js/jquery-migrate.js"></script>
<script src="../assets/plugins/js/modernizer.min.js"></script>
<script src="../assets/plugins/js/bootstrap.min.js"></script>
<script src="../assets/plugins/js/gsap/gsap.js"></script>
<script src="../assets/plugins/js/gsap/gsap-scroll-to-plugin.js"></script>
<script src="../assets/plugins/js/gsap/gsap-scroll-smoother.js"></script>
<script src="../assets/plugins/js/gsap/gsap-scroll-trigger.js"></script>
<script src="../assets/plugins/js/gsap/gsap-split-text.js"></script>
<script src="../assets/plugins/js/wow.min.js"></script>
<script src="../assets/plugins/js/owl.carousel.min.js"></script>
<script src="../assets/plugins/js/magnific-popup.min.js"></script>
<script src="../assets/plugins/js/jquery.counterup.min.js"></script>
<script src="../assets/plugins/js/waypoints.min.js"></script>
<script src="../assets/plugins/js/nice-select.min.js"></script>
<script src="../assets/plugins/js/ep-cursor.js"></script>
<script src="../assets/plugins/js/backToTop.js"></script>
<script src="../assets/plugins/js/active.js"></script>
    </body>
</html>